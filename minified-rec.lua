local a=nil;local b=workspace.Configuration.Wave;b:GetPropertyChangedSignal("Value"):Connect(function()if b.Value>0 then if b.Value==1 then a=workspace:GetServerTimeNow()end end end)local function c(d,e)if d and d.Parent then table.insert(e,d.Parent==game and"game"or d.Parent.Name)c(d.Parent,e)end end;local function f(d,g)local e={d.Name}c(d,e)local h=e[#e]if g then for i=#e-1,1,-1 do h=h..":WaitForChild(\""..e[i].."\")"end else for i=#e-1,1,-1 do local j=e[i]if j:match("[^%w_]+")or j:sub(1,1):match("%d")then h=h.."[\""..j.."\"]"else h=h.."."..j end end end;return h end;function getPriceofCombo(k,l)if not l then return game.ReplicatedStorage.Characters[k].Stats.UsageCost.Value end;return game.ReplicatedStorage.Guns[l].Stats.UsageCost.Value+game.ReplicatedStorage.Characters[k].Stats.UsageCost.Value end;function getPriceOfUpgrade(k,m)return k.Upgrades[m][k.UpgradeLevels[m].Value+1]:GetChildren()[1].UsageCost.Value end;function getCurrentTime()return math.floor((workspace:GetServerTimeNow()-a)*100)/100 end;local n={["Stronger Enemies"]="EnemyHealth",["Panic Mode"]="OneHealth",["Hyperinflation"]="TowerCost",["Social Distancing"]="Distancing",["Ghostified Enemies"]="Camouflage",["Stun Madness"]="TrueStunMadness",["Regeneration"]="Regeneration",["Low Supply"]="LowTowerLimit",["Impossible"]="Impossible",["Speedrun"]="Speedrun",["Less Gadgets"]="LessGadgets",["No Refund"]="NoRefund",["Bad Connection"]="BadConnection",["More Firepower, More Gain"]="NoTowerSpam",["Halved Budget"]="HalvedCash",["Gun Shortage"]="GunLimit",["Sandbox"]="Sandbox",["Hellspeed"]="Hellspeed",["Mega Stuns"]="MegaStuns",["Sabotaged Gadgets"]="SabotagedGadgets"}writefile("recorded_pgtd.lua","local pgtd = loadstring(game:HttpGet(\"https://raw.githubusercontent.com/usamiername/pgtd-replayer/main/minified.lua\"))()\npgtd.set(\""..workspace.Configuration.MapName.Value.."\", "..tostring(workspace.Difficulty.Value)..", {")for o in string.gmatch(workspace.Configuration.ModifierNames.Value,"[^/]+")do appendfile("recorded_pgtd.lua","\""..n[o].."\",")end;appendfile("recorded_pgtd.lua","})\n")local p=getrawmetatable(game)local q=p.__namecall;setreadonly(p,false)p.__namecall=newcclosure(function(self,...)local r=getnamecallmethod()local s={...}r=tostring(r)if r=="FireServer"and tostring(self)=="PlaceTower"then spawn(function()for g,o in pairs(workspace.Map:GetDescendants())do if o==s[5]then if s[2]then if game.Players.LocalPlayer.Cash.Value>=getPriceofCombo(s[2],s[3])then if workspace.Configuration.Wave.Value==0 then for t,u in pairs(o.Parent:GetChildren())do if o==u then appendfile("recorded_pgtd.lua","pgtd.placeTower(\""..tostring(s[2]).."\", \""..tostring(s[3]).."\", Vector3.new("..tostring(s[1]).."), Vector3.new("..tostring(s[6]).."), "..f(o.Parent,false)..":GetChildren()["..tostring(t).."], 0)\n")end end else for t,u in pairs(o.Parent:GetChildren())do if o==u then appendfile("recorded_pgtd.lua","pgtd.placeTower(\""..tostring(s[2]).."\", \""..tostring(s[3]).."\", Vector3.new("..tostring(s[1]).."), Vector3.new("..tostring(s[6]).."), "..f(o.Parent,false)..":GetChildren()["..tostring(t).."], "..getCurrentTime()..")\n")end end end end elseif not string.match(s[5]:GetFullName(),"AutoLandmineSpot")then if workspace.Configuration.Wave.Value==0 then for t,u in pairs(o.Parent:GetChildren())do if o==u then appendfile("recorded_pgtd.lua","pgtd.useAbility(\""..s[4].."\", Vector3.new("..tostring(s[1]).."), Vector3.new("..tostring(s[6]).."), "..f(o.Parent,false)..":GetChildren()["..tostring(t).."], 0)\n")end end else for t,u in pairs(o.Parent:GetChildren())do if o==u then appendfile("recorded_pgtd.lua","pgtd.useAbility(\""..s[4].."\", Vector3.new("..tostring(s[1]).."), Vector3.new("..tostring(s[6]).."), "..f(o.Parent,false)..":GetChildren()["..tostring(t).."], "..getCurrentTime()..")\n")end end end end;break end end end)elseif r=="FireServer"and tostring(self)=="Action"then spawn(function()if s[1]=="Upgrade"then for g,o in pairs(workspace.Map.Towers:GetChildren())do if self.Parent==o then if game.Players.LocalPlayer.Cash.Value>=getPriceOfUpgrade(self.Parent,s[2])then if workspace.Configuration.Wave.Value==0 then appendfile("recorded_pgtd.lua","pgtd.upgradeTower("..tostring(g)..", \""..s[2].."\",  0)\n")else appendfile("recorded_pgtd.lua","pgtd.upgradeTower("..tostring(g)..", \""..s[2].."\", "..getCurrentTime()..")\n")end end end end elseif s[1]=="Sell"then for g,o in pairs(workspace.Map.Towers:GetChildren())do if self.Parent==o then if workspace.Configuration.Wave.Value==0 then appendfile("recorded_pgtd.lua","pgtd.sellTower("..tostring(g)..",  0)\n")else appendfile("recorded_pgtd.lua","pgtd.sellTower("..tostring(g)..", "..getCurrentTime()..")\n")end end end elseif s[1]=="Targetting"then for g,o in pairs(workspace.Map.Towers:GetChildren())do if self.Parent==o then if workspace.Configuration.Wave.Value==0 then appendfile("recorded_pgtd.lua","pgtd.changeTarget("..tostring(g)..", "..s[2]..",  0)\n")else appendfile("recorded_pgtd.lua","pgtd.changeTarget("..tostring(g)..", \""..s[2].."\", "..getCurrentTime()..")\n")end end end end end)end;return q(self,unpack(s))end)setreadonly(p,true)
